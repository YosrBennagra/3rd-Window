# CI/CD Quick Reference

Quick commands and reminders for ThirdScreen's CI/CD workflow.

## Daily Commands

```bash
# Development
npm run tauri:dev              # Start dev server with hot reload

# Validation
npm run version:check          # Check version sync
npm run build:validate         # Validate build environment

# Building
npm run build                  # Build frontend only
npm run tauri:build            # Build production installer
```

## Version Management

```bash
# Check versions
npm run version:check

# Sync to specific version
node scripts/sync-version.js 1.2.3

# Increment versions
node scripts/sync-version.js patch    # 1.0.0 → 1.0.1
node scripts/sync-version.js minor    # 1.0.0 → 1.1.0
node scripts/sync-version.js major    # 1.0.0 → 2.0.0
```

## Release Checklist

- [ ] Update version: `node scripts/sync-version.js X.Y.Z`
- [ ] Verify sync: `npm run version:check`
- [ ] Commit: `git commit -am "chore: bump version to X.Y.Z"`
- [ ] Tag: `git tag vX.Y.Z`
- [ ] Push: `git push origin main --tags`
- [ ] Monitor: [GitHub Actions](https://github.com/YosrBennagra/3rd-Window/actions)
- [ ] Verify: Check [Releases page](https://github.com/YosrBennagra/3rd-Window/releases)

## CI/CD Principles

✅ **DO:**
- Keep versions synchronized across all config files
- Use `npm ci` in CI (not `npm install`)
- Externalize secrets to environment variables
- Test builds locally before pushing
- Use semantic versioning (major.minor.patch)

❌ **DON'T:**
- Commit `.env` files or secrets
- Hardcode file paths or machine-specific config
- Skip version validation
- Manually edit version files (use sync script)
- Break backward compatibility without major version bump

## Troubleshooting

**Version mismatch:**
```bash
node scripts/sync-version.js <correct-version>
```

**Build validation fails:**
```bash
npm run build:validate  # See specific errors
```

**CI build fails:**
- Check [GitHub Actions logs](https://github.com/YosrBennagra/3rd-Window/actions)
- Reproduce locally: `npm ci && npm run tauri:build`

**Release not triggered:**
- Tag must match `v*.*.*` format (e.g., `v1.0.0`)
- Push tags: `git push --tags`

## GitHub Secrets

Required for signed releases:
- `TAURI_SIGNING_PRIVATE_KEY` - Base64-encoded PFX certificate
- `TAURI_SIGNING_PRIVATE_KEY_PASSWORD` - Certificate password

Add at: [Repository Settings → Secrets](https://github.com/YosrBennagra/3rd-Window/settings/secrets/actions)

## Files Modified by CI/CD

**Never commit manually:**
- `package-lock.json` - Generated by npm
- `Cargo.lock` - Generated by Cargo
- `src-tauri/target/` - Build artifacts

**Always commit:**
- `package.json` - Version + dependencies
- `src-tauri/Cargo.toml` - Version + dependencies
- `src-tauri/tauri.conf.json` - Version + app config

## Links

- [Full CI/CD Documentation](./ci-cd.md)
- [GitHub Actions Workflows](../.github/workflows/)
- [Tauri Documentation](https://tauri.app/v2/)
- [Releases](https://github.com/YosrBennagra/3rd-Window/releases)
